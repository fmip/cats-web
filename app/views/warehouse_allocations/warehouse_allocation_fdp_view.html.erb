<div class="row wrapper border-bottom white-bg page-heading">
  <div class="col-sm-4">
    <h2>Warehouse allocation</h2>
    <ol class="breadcrumb">
      <li>
        <a href="#">Home</a>
      </li>
      <li class="active">
        <strong>Warehouse allocation</strong>
      </li>
    </ol>
  </div>
  <div class="col-sm-8">
    <div class="title-action">
      <a  class = "btn btn-default" href="/warehouse_allocations/warehouse_allocation_zonal_view?operation=<%= params['operation'] %>&region=<%= params['region'] %>">Cancel</a>
    </div>
  </div>
</div>

<div class="row">

<div class="wrapper wrapper-content">
  <div class="ibox float-e-margins">
    <div class="ibox-content">

      <%= form_tag( '/warehouse_allocations/warehouse_allocation_fdp_view' ,{ class: 'form-inline', style: 'display: inline-block;', role: 'form', method: 'GET'}) do %>

          <div class="form-group">
            <%= label_tag :operation, "Operation", { :class => ' control-label'} %>

            <div class="">
              <%= select_tag  :operation,  options_from_collection_for_select( Operation.all, 'id', 'name', params[:operation] ) , {:required => true , :prompt => "-- Choose --", :class => 'form-control col-md-3 data-parsley-required' }  %>
            </div>
          </div>
          <div class="form-group">
            <%= label_tag :region, "Region", { :class => ' control-label'} %>

            <div class="">
              <%= select_tag  :region,  options_from_collection_for_select( Location.where(location_type:'region').order('name ASC'), 'id', 'name', params[:region] ) , {:required => true , :prompt => "-- Choose --", :class => 'form-control col-md-3 data-parsley-required' }  %>
            </div>
          </div>

           <div class="form-group">
            <%= label_tag :zone, "Zone", { :class => ' control-label'} %>

            <div class="">
              <% if params[:region].present? %>
                <%= select_tag :zone, options_from_collection_for_select(Location.find(params[:region])&.children.where(:location_type => :zone), "id", "name", params[:zone]),
                  :required => true , :class => 'form-control width-100per', :style => 'min-width: 80px',
                  "data-option-dependent" => true,
                  "data-option-observed" => "region",
                  "data-option-url" => "/locations/#{:region}/children",
                  "data-option-key-method" => :id,
                  "data-option-value-method" => :name %>
              <% end %>
            </div>
          </div>
          <div class="form-group">
            <label for=""></label>
            <div>
              <input type="submit" name="filter" value="Go" class="btn btn-sm btn-primary" />
            </div>
          </div>

      <% end %>

    </div>
  </div>
  <div class="ibox float-e-margins">
  <% @requisition_items.each do |woreda , requisition_details| %>
    <div class="ibox-title">
                <h5> <%=  Location.find(woreda).name %> </h5>
                <div class="ibox-tools">
    
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                </div>
            </div>

    <div class="ibox-content">
      <table class="table table-striped  cats-datatable">
        <thead>
          <tr>
                        <th>FDP</th>
                        <th>Beneficiary No</th>
                        <th>Allocated</th>
                        <th>Hub</th>
                        <th></th>

          </tr>
        </thead>

        <tbody>
          <% requisition_details.each do |requisition_detail| %>
          <tr>
                        <td> <%= requisition_detail&.fdp&.name %> </td>
                        <td><%=  requisition_detail.amount %></td>
                        <td><%=  requisition_detail.beneficiary_no %></td>
                        <td> <%=  WarehouseAllocationItem.find_by(fdp_id: requisition_detail.fdp_id)&.warehouse&.name  %> </td>
                        <td> <%= link_to 'Change', '#' %> </td>
          </tr>
           
          <% end %>
        </tbody>
      </table>

    </div>
    <%end%>
  </div>
  
</div>

</div>